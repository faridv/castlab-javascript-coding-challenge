/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";class t{offset=0;constructor(t){this.offset=void 0===t?0:t}}class e{constructor(e){this._cursor=new t,this.boxes=[],e&&(this._raw=new DataView(e))}parse(){for(this._cursor.offset=0,this.boxes=[];this._cursor.offset<this._raw.byteLength;){let t=s.parse(this);void 0!==t.type&&this.boxes.push(t)}return this}}class s{_boxContainers=["moof","mfhd","traf","tfhd","trun","mdat"];_boxProcessors={mdat:()=>{this._procField("data","data",-1)},mfhd:()=>{this._procFullBox(),this._procField("sequence_number","uint",32)},tfhd:()=>{this._procFullBox(),this._procField("track_ID","uint",32),1&this.flags&&this._procField("base_data_offset","uint",64),2&this.flags&&this._procField("sample_description_offset","uint",32),8&this.flags&&this._procField("default_sample_duration","uint",32),16&this.flags&&this._procField("default_sample_size","uint",32),32&this.flags&&this._procField("default_sample_flags","uint",32)},trun:()=>{this._procFullBox(),this._procField("sample_count","uint",32),1&this.flags&&this._procField("data_offset","int",32),4&this.flags&&this._procField("first_sample_flags","uint",32),this._procEntries("samples",this.sample_count,(function(t){256&this.flags&&this._procEntryField(t,"sample_duration","uint",32),512&this.flags&&this._procEntryField(t,"sample_size","uint",32),1024&this.flags&&this._procEntryField(t,"sample_flags","uint",32),2048&this.flags&&this._procEntryField(t,"sample_composition_time_offset",1===this.version?"int":"uint",32)}))}};_cursor;_offset=0;_root;_raw;_parent;constructor(){this._cursor=new t}static parse(t){const e=new s;return e._offset=t._cursor.offset,e._root=t._root?t._root:t,e._raw=t._raw,e._parent=t,e._parseBox(),t._cursor.offset=e._raw.byteOffset+e._raw.byteLength,e}_procField(t,e,s){this[t]=this._readField(e,s)}_procFieldArray(t,e,s,i){this[t]=[];for(let r=0;r<e;r++)this[t][r]=this._readField(s,i)}_procEntryField(t,e,s,i){t[e]=this._readField(s,i)}_procFullBox(){this._procField("version","uint",8),this._procField("flags","uint",24)}_procEntries(t,e,s){let i;if(this._parsing)for(this[t]=[],i=0;i<e;i++)this[t].push({}),s.call(this,this[t][i]);else for(i=0;i<e;i++)s.call(this,this[t][i])}_readField(t,e){switch(t){case"uint":return this._readUint(e);case"int":return this._readInt(e);case"string":return-1===e?this._readTerminatedString():this._readString(e);case"data":return this._readData(e);case"utf8":return this._readUTF8String();default:return-1}}_readInt(t){let e=null,s=this._cursor.offset-this._raw.byteOffset;switch(t){case 8:e=this._raw.getInt8(s);break;case 16:e=this._raw.getInt16(s);break;case 32:e=this._raw.getInt32(s);break;case 64:let t=this._raw.getInt32(s),i=this._raw.getInt32(s+4);e=t*Math.pow(2,32)+i}return this._cursor.offset+=t>>3,e}_readUint(t){let e,s,i=null,r=this._cursor.offset-this._raw.byteOffset;switch(t){case 8:i=this._raw.getUint8(r);break;case 16:i=this._raw.getUint16(r);break;case 24:e=this._raw.getUint16(r),s=this._raw.getUint8(r+2),i=(e<<8)+s;break;case 32:i=this._raw.getUint32(r);break;case 64:e=this._raw.getUint32(r),s=this._raw.getUint32(r+4),i=e*Math.pow(2,32)+s}return this._cursor.offset+=t>>3,i}_readString(t){let e="";for(let s=0;s<t;s++){let t=this._readUint(8);e+=String.fromCharCode(t)}return e}_readTerminatedString(){let t="";for(;this._cursor.offset-this._offset<this._raw.byteLength;){let e=this._readUint(8);if(0==e)break;t+=String.fromCharCode(e)}return t}_readData(t){let e=t>0?t:this._raw.byteLength-(this._cursor.offset-this._offset);if(e>0){let t=new Uint8Array(this._raw.buffer,this._cursor.offset,e);return this._cursor.offset+=e,t}return null}_readUTF8String(){let t=this._raw.byteLength-(this._cursor.offset-this._offset),e=null;return t>0&&(e=new DataView(this._raw.buffer,this._cursor.offset,t),this._cursor.offset+=t),e?new TextDecoder("utf-8").decode(e):e}_parseBox(){if(this._parsing=!0,this._cursor.offset=this._offset,this._offset+8>this._raw.buffer.byteLength)this._root._incomplete=!0;else{switch(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this.size){case 0:this._raw=new DataView(this._raw.buffer,this._offset,this._raw.byteLength-this._cursor.offset+8);break;case 1:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.largesize);break;default:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.size)}this._incomplete||(this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type)?this._parseContainerBox():this._data=this._readData())}}_parseContainerBox(){for(this.boxes=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.boxes.push(s.parse(this))}}new class{mediaUrl="";constructor(t){void 0!==t&&t&&(this.mediaUrl=t),this.fetchMedia()}fetchMedia(){fetch(this.mediaUrl,{}).then((t=>(this.log(`Successfully loaded file ${this.mediaUrl}`),t.blob()))).then((t=>t.arrayBuffer())).then((t=>{const s=new e(t).parse();this.handleBoxes(s.boxes)}))}handleBoxes(t){t.forEach((t=>{this.log(`Found box of type ${t.type} and size ${t.size}`),void 0!==t.boxes&&t.boxes.length&&this.handleBoxes(t.boxes),"mdat"===t.type.toLowerCase()&&this.handleMdat(t.data)}))}handleMdat(t){const e=(new TextDecoder).decode(t);this.log("Content of mdat box is: ",e),-1!==e.indexOf("<smpte:image")&&this.renderImages(e)}renderImages(t){const e=(new DOMParser).parseFromString(t,"application/xml").getElementsByTagName("smpte:image");e.length&&Array.from(e).forEach((t=>{document.body.appendChild(Object.assign(document.createElement("img"),{src:`data:image/jpeg;base64,${t.innerHTML}`}))}))}log(...t){console.log(t.join(""))}}("https://demo.castlabs.com/tmp/text0.mp4")})();